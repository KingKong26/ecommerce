<!--::header part start::-->
{{!-- css for search --}}
<style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;500;600;700&display=swap');


    ::selection {
        color: #fff;
        background: #664AFF;
    }

    .wrapper {
        max-width: 450px;
        max-height: 50px;
        margin: auto;
    }

    .wrapper .search-input {
        background: #fff;
        width: 100%;
        border-radius: 5px;
        justify-content: center;
        position: relative;
        box-shadow: 0px 1px 5px 3px rgba(0, 0, 0, 0.12);
    }

    .icon {
        justify-content: center;
        position: relative;
        margin-top: auto;
        padding-bottom: 20px;
    }

    .search-input input {
        height: 30px;
        width: 100%;
        outline: none;
        border: none;
        border-radius: 5px;
        padding: 0 60px 0 20px;
        font-size: 18px;
        box-shadow: 0px 1px 5px rgba(0, 0, 0, 0.1);
    }

    .search-input.active input {
        border-radius: 5px 5px 0 0;
    }

    .search-input .autocom-box {
        padding: 0;
        opacity: 0;
        pointer-events: none;
        max-height: 280px;
        overflow-y: auto;
    }

    .search-input.active .autocom-box {
        padding: 10px 8px;
        opacity: 1;
        pointer-events: auto;
    }

    .autocom-box li {
        list-style: none;
        padding: 8px 12px;
        display: none;
        width: 100%;
        cursor: default;
        border-radius: 3px;
    }

    .search-input.active .autocom-box li {
        display: block;
    }

    .autocom-box li:hover {
        background: #efefef;
    }

    .search-input .icon {
        position: absolute;
        right: 0px;
        top: 0px;
        height: 55px;
        width: 55px;
        text-align: center;
        line-height: 55px;
        font-size: 20px;
        color: #644bff;
        cursor: pointer;
    }

    @media screen and (max-width: 600px) {
        .wrapper {
            display: none;
        }

        .navbar-toggler {
            padding-top: 35px;
        }
    }

    .position-fixed {
        width: 1140px;
    }

    .navbar {
        padding: 0px 10px
    }
</style>
{{!-- --}}
<header class="main_menu home_menu" >
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-12">
                <nav class="navbar position-fixed navbar-expand-lg navbar-light " style="padding: 0 10px;">
                    <a class="navbar-brand" href="/"> <img src="/img/logo-2.png" alt="logo"> </a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse"
                        data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                        aria-expanded="false" aria-label="Toggle navigation">
                        <span class="menu_icon"><i class="fas fa-bars"></i></span>
                    </button>

                    <div class="collapse navbar-collapse main-menu-item" id="navbarSupportedContent">
                        <ul class="navbar-nav">
                            <li class="nav-item">
                                <a class="nav-link" href="/">Home</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="blog.html" id="navbarDropdown_1" role="button"
                                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    Category
                                </a>
                                <div class="dropdown-menu" aria-labelledby="navbarDropdown_1">
                                    {{#each categories}}
                                    <a class="dropdown-item"
                                        href="/all-products/{{this.categories}}">{{this.categories}}</a>
                                    {{/each}}
                                </div>
                            </li>
                            <li class="nav-item dropdown">
                                <a class="nav-link " href="/all-products">
                                    Shop
                                </a>
                            </li>
                            {{#if user}}
                            <li class="nav-item dropdown">
                                {{#if user.firstname}}
                                <a class="nav-link dropdown-toggle" href="blog.html" id="navbarDropdown_3" role="button"
                                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    {{user.firstname}}
                                </a>
                                {{else}}
                                <a class="nav-link dropdown-toggle" href="blog.html" id="navbarDropdown_3" role="button"
                                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <i class="far fa-user mr-3"></i>
                                </a>
                                {{/if}}
                                <div class="dropdown-menu" aria-labelledby="navbarDropdown_2">
                                    <a class="dropdown-item" href="/profile">Profile</a>
                                    <a class="dropdown-item" href="/orders">Orders</a>
                                    <a class="dropdown-item" href="/cart">Cart</a>
                                    <a class="dropdown-item" href="/coupons">Coupons</a>
                                    <a class="dropdown-item" href="/wishlist">Wishlist</a>
                                    <a class="dropdown-item" href="/logout">Logout</a>
                                </div>
                            </li>
                            {{else}}
                            <li class="nav-item dropdown">
                                <a class="nav-link" href="/login" id="navbarDropdown_3" aria-expanded="false">
                                    Account
                                </a>
                            </li>
                            {{/if}}
                        </ul>
                    </div>
                    <div class="hearer_icon d-flex" >
                        {{!-- search test --}}
                        <div class="wrapper ">
                            <div class="search-input ">
                                <a href="" target="" hidden></a>
                                <input type="text" placeholder="Type to search..">
                                <div class="autocom-box">
                                    <!-- here list are inserted from javascript -->
                                </div>
                                <div class="icon d-flex inline " style="margin-top: 5px;"><i class="fas fa-search"></i>
                                </div>
                            </div>
                        </div>
                        {{!-- search test --}}
                        {{!-- <a id="search_1" href="javascript:void(0)"><i class="ti-search"></i></a> --}}
                        <div class="wrapper d-flex inline" >
                            <a href="/profile" class=""><i class="far fa-user"></i></a>
                            <a href="/wishlist"><i class="fas fa-heart"></i></a>
                            <div class="d-flex inline" >
                                <div>
                                <a href="/cart" id="navbarDropdown3">
                                    <i class="fas fa-cart-plus"></i>
                                    <span class="badge badge-success" id="cart-count">{{cartCount}}</span>
                                </a>
                                </div>
                                
                            </div>
                        </div>

                        <!-- <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                                    <div class="single_product">
    
                                    </div>
                                </div> -->


                    </div>
                </nav>
            </div>
        </div>
    </div>
    <div hidden id="users-source" data-users='{{ json data }}'></div>
    {{!-- <div class="search_input" id="search_input_box">
        <div class="container ">
            <form class="d-flex justify-content-between search-inner">
                <input type="text" class="form-control" id="search_input" placeholder="Search Here">
                <button type="submit" class="btn"></button>
                <span class="ti-close" id="close_search" title="Close Search"></span>
            </form>
        </div>
    </div> --}}
</header>
<!-- Header part end-->

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<script>

    // getting all required elements
    const searchWrapper = document.querySelector(".search-input");
    const inputBox = searchWrapper.querySelector("input");
    const suggBox = searchWrapper.querySelector(".autocom-box");
    const icon = searchWrapper.querySelector(".icon");
    let linkTag = searchWrapper.querySelector("a");
    let webLink;
    let suggestions = {{{ json productsList }}}
    console.log("hello")
    console.log(suggestions)
    // if user press any key and release
    inputBox.onkeyup = (e) => {
        let userData = e.target.value; //user enetered data
        let emptyArray = [];
        if (userData) {
            icon.onclick = () => {
                webLink = "/all-products" + userData;
                linkTag.setAttribute("href", webLink);
                console.log(webLink);
                linkTag.click();
            }
            emptyArray = suggestions.filter((data) => {
                let name = data.productname
                console.log(name)
                //filtering array value and user characters to lowercase and return only those words which are start with user enetered chars
                return name.toLocaleLowerCase().startsWith(userData.toLocaleLowerCase());
            });
            emptyArray = emptyArray.map((data) => {
                // passing return data inside li tag
                return data = '<li id="' + data._id + '">' + data.productname + '</li>';
            });
            searchWrapper.classList.add("active"); //show autocomplete box
            showSuggestions(emptyArray);
            let allList = suggBox.querySelectorAll("li");
            for (let i = 0; i < allList.length; i++) {
                //adding onclick attribute in all li tag
                allList[i].setAttribute("onclick", "select(this)");
            }
        } else {
            searchWrapper.classList.remove("active"); //hide autocomplete box
        }
    }

    function select(element) {
        console.log(element.id, "hellololo")
        let selectData = element.id;
        inputBox.value = element.textContent;
        icon.onclick = () => {
            webLink = "/product-details/?id=" + selectData;
            linkTag.setAttribute("href", webLink);
            linkTag.click();
        }
        searchWrapper.classList.remove("active");
    }

    function showSuggestions(list) {
        let listData;
        if (!list.length) {
            userValue = inputBox.value;
            listData = '<li>' + userValue + '</li>';
        } else {
            listData = list.join('');
        }
        suggBox.innerHTML = listData;
    }
</script>